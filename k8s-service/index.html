<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.351cb4de4fb8fafa1978.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.32.13"/><style data-styled="" data-styled-version="5.3.3">.iwJLgg{-webkit-text-decoration:none;text-decoration:none;color:rgba(0,0,0,0.8);}/*!sc*/
data-styled.g1[id="styled-link__StyledLink-sc-1pzq7s8-0"]{content:"iwJLgg,"}/*!sc*/
.eMJSpf{box-shadow:0 4px 12px 0 rgba(0,0,0,0.05);height:6rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
data-styled.g2[id="header__Container-sc-1hjyk8g-0"]{content:"eMJSpf,"}/*!sc*/
.jJfoNH{font-size:1.6rem;font-weight:800;-webkit-letter-spacing:0.1rem;-moz-letter-spacing:0.1rem;-ms-letter-spacing:0.1rem;letter-spacing:0.1rem;text-transform:uppercase;margin:0;}/*!sc*/
@media (max-width:36em){.jJfoNH{text-align:center;}}/*!sc*/
data-styled.g3[id="header__Title-sc-1hjyk8g-1"]{content:"jJfoNH,"}/*!sc*/
@font-face{font-family:system;font-style:normal;font-weight:300;src:local('.SFNSText-Light'),local('.HelveticaNeueDeskInterface-Light'),local('.LucidaGrandeUI'),local('Ubuntu Light'),local('Segoe UI Light'),local('Roboto-Light'),local('DroidSans'),local('Tahoma');}/*!sc*/
:root{font-size:10px;}/*!sc*/
body{font-family:'system';margin:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);min-height:100vh;position:relative;font-size:1.6rem;}/*!sc*/
h1,h2,h3,h4,h5,h6{font-family:sans-serif;}/*!sc*/
h2{font-size:2.5rem;}/*!sc*/
h3{font-size:2.4rem;}/*!sc*/
h4{font-size:1.6rem;}/*!sc*/
code{font-family:Menlo,Monaco,"Courier New",Courier,monospace;word-break:break-word;}/*!sc*/
pre code{word-break:normal;}/*!sc*/
:not(pre) > code[class*="language-"],pre[class*="language-text"]{background-color:transparent;color:inherit;font-size:medium;}/*!sc*/
data-styled.g4[id="sc-global-hvINus1"]{content:"sc-global-hvINus1,"}/*!sc*/
.doySxy{display:block;height:6rem;}/*!sc*/
data-styled.g5[id="layout__Footer-sc-wzore3-0"]{content:"doySxy,"}/*!sc*/
.hYEVc{width:60%;max-width:728px;margin:0 auto;}/*!sc*/
@media (max-width:48em){.hYEVc{width:80%;}}/*!sc*/
data-styled.g6[id="layout__Content-sc-wzore3-1"]{content:"hYEVc,"}/*!sc*/
.gOfPmA{margin-top:8rem;}/*!sc*/
.gOfPmA img{width:100%;}/*!sc*/
@media (max-width:36em){.gOfPmA{margin-top:4rem;}}/*!sc*/
.gOfPmA p{line-height:1.5;}/*!sc*/
.gOfPmA blockquote{margin-left:0.25rem;font-size:1.6rem;color:inherit;font-style:italic;border-left:0.2rem solid rgb(0,0,0);padding-left:1rem;margin:1rem 0;}/*!sc*/
.gOfPmA pre{margin-bottom:2rem;}/*!sc*/
.gOfPmA h3{line-height:1.13;}/*!sc*/
.gOfPmA h2,.gOfPmA h3,.gOfPmA h4,.gOfPmA h5,.gOfPmA h6{margin:2rem 0 2rem;}/*!sc*/
.gOfPmA hr{border:0;border-top:0.1rem solid #ccc;display:block;height:1rem;padding:0;}/*!sc*/
data-styled.g18[id="post-styles__Container-sc-uvw59-0"]{content:"gOfPmA,"}/*!sc*/
@media (max-width:48em){.drQYUS{text-align:center;}}/*!sc*/
data-styled.g19[id="post-styles__Header-sc-uvw59-1"]{content:"drQYUS,"}/*!sc*/
.cCkgzF{margin-bottom:1rem;font-size:3rem;}/*!sc*/
data-styled.g20[id="post-styles__Title-sc-uvw59-2"]{content:"cCkgzF,"}/*!sc*/
.gmHquH{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0px;}/*!sc*/
data-styled.g21[id="post-styles__LinkList-sc-uvw59-3"]{content:"gmHquH,"}/*!sc*/
.beCzyQ{margin:1rem 0 5rem;}/*!sc*/
.beCzyQ .social-icon{display:inline-block;margin:0 0.5rem;cursor:pointer;}/*!sc*/
data-styled.g22[id="share__Container-sc-1hk3kno-0"]{content:"beCzyQ,"}/*!sc*/
.jiUAsV{font-size:1.4rem;color:rgb(0,0,0);}/*!sc*/
data-styled.g23[id="share___StyledP-sc-1hk3kno-1"]{content:"jiUAsV,"}/*!sc*/
.jyOtij{color:rgba(0,0,0,0.8);}/*!sc*/
data-styled.g24[id="blog-post___StyledSub-sc-1cxuom3-0"]{content:"jyOtij,"}/*!sc*/
.gjclbs{margin:5rem 0;}/*!sc*/
data-styled.g25[id="blog-post___StyledDiv-sc-1cxuom3-1"]{content:"gjclbs,"}/*!sc*/
</style><title data-react-helmet="true">쿠버네티스 서비스</title><meta data-react-helmet="true" name="description" content="서비스 개념 파드는 컨트롤러가 관리하므로 한군데에 고정해서 실행되지 않고 클러스터 안을 옮겨 다님 노드를 옮기면서 실행되기도 하고 클러스터 안 파드의 IP…"/><meta data-react-helmet="true" property="og:title" content="쿠버네티스 서비스"/><meta data-react-helmet="true" property="og:description" content="서비스 개념 파드는 컨트롤러가 관리하므로 한군데에 고정해서 실행되지 않고 클러스터 안을 옮겨 다님 노드를 옮기면서 실행되기도 하고 클러스터 안 파드의 IP…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://blog.zooneon.dev"/><meta data-react-helmet="true" property="og:locale" content="ko_KR"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="zooneon"/><meta data-react-helmet="true" name="twitter:title" content="쿠버네티스 서비스"/><meta data-react-helmet="true" name="twitter:description" content="서비스 개념 파드는 컨트롤러가 관리하므로 한군데에 고정해서 실행되지 않고 클러스터 안을 옮겨 다님 노드를 옮기면서 실행되기도 하고 클러스터 안 파드의 IP…"/><link rel="preconnect dns-prefetch" href="https://www.googletagmanager.com"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32.png?v=5fa6e614f0c84651b75fe27d99928ac0" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-302c830d723193e48eb2.js"/><link as="script" rel="preload" href="/framework-45f0bfe9f06e0e8da7d0.js"/><link as="script" rel="preload" href="/styles-bc72ca78f9bad9fb1f45.js"/><link as="script" rel="preload" href="/app-2c7963cebb708efe718f.js"/><link as="script" rel="preload" href="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-257226443b7dcc72fbb2.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-fe46313b564a949646ae.js"/><link as="fetch" rel="preload" href="/page-data/k8s-service/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/983108779.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript>Sorry! This site requires JavaScript to be enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="header__Container-sc-1hjyk8g-0 eMJSpf"><a class="styled-link__StyledLink-sc-1pzq7s8-0 iwJLgg" href="/"><h1 class="header__Title-sc-1hjyk8g-1 jJfoNH">zooneon&#x27;s dev log</h1></a></nav><div class="layout__Content-sc-wzore3-1 hYEVc"><article class="post-styles__Container-sc-uvw59-0 gOfPmA"><header class="post-styles__Header-sc-uvw59-1 drQYUS"><h1 class="post-styles__Title-sc-uvw59-2 cCkgzF">쿠버네티스 서비스</h1><sub class="blog-post___StyledSub-sc-1cxuom3-0 jyOtij"><span>Posted on <!-- -->November 16, 2022</span><span>  -  </span><span>9 min read</span></sub></header><div class="blog-post___StyledDiv-sc-1cxuom3-1 gjclbs"><h2>서비스 개념</h2>
<ul>
<li>파드는 컨트롤러가 관리하므로 한군데에 고정해서 실행되지 않고 클러스터 안을 옮겨 다님</li>
<li>노드를 옮기면서 실행되기도 하고 클러스터 안 파드의 IP가 변경되기도 함</li>
<li>동적으로 변하는 파드들에 고정적으로 접근할 때 사용하는 방법이 쿠버네티스의 <code class="language-text">서비스</code></li>
<li>서비스를 사용하면 고정 주소를 이용해 파드에 접근 가능</li>
<li>
<p>클러스터 외부에서 클러스터 안 파드에 접근 가능</p>
<ul>
<li>클러스터 외부에서 인그레스 <code class="language-text">Ingress</code> 로도 접근할 수 있지만 서비스는 주로 L4 영역에서 통신할 때 사용하고 인그레스는 L7 영역에서 통신할 때 사용</li>
<li>두 가지를 혼합해서 사용할 수도 있지만 보통 역할을 분리해서 사용</li>
</ul>
</li>
</ul>
<h2>서비스 타입</h2>
<ul>
<li>
<p>ClusterIP</p>
<ul>
<li>기본 서비스 타입</li>
<li>쿠버네티스 클러스터 안에서만 사용 가능</li>
<li>클러스터 안 노드나 파드에서는 ClusterIP를 이용해서 서비스에 연결된 파드에 접근</li>
<li>클러스터 외부에서는 이용 불가능</li>
</ul>
</li>
<li>
<p>NodePort</p>
<ul>
<li>서비스 하나에 모든 노드의 지정된 포트를 할당</li>
<li>포트번호 지정 안할 시 <code class="language-text">30000 ~ 32768</code> 랜덤포트 사용</li>
<li>노드에 상관없이 서비스에 지정된 포트 번호만 사용하면 파드에 접근 가능</li>
<li>노드의 포트를 사용하므로 클러스터 외부에서도 접근 가능</li>
<li>node1에서 파드가 실행 중이고 node2에서 실행 중이지 않을 때 node2로 접근해도 node1에 실행된 파드로 연결 가능</li>
<li>단 <code class="language-text">second hop</code> 문제 발생 가능 → latency 발생</li>
<li>클러스터 외부에서 클러스터 안 파드로 접근할 때 사용할 수 있는 가장 간단한 방법</li>
</ul>
</li>
<li>
<p>LoadBalancer</p>
<ul>
<li>AWS, GCP, OpenStack, 쿠버네티스를 지원하는 로드밸런서 장비에서 사용</li>
<li>클라우드에서 제공하는 로드밸런서와 파드를 연결한 후 해당 로드밸런서의 IP를 이용해 클러스터 외부에서 파드에 접근할 수 있도록 해줌</li>
<li>서비스 타입 <code class="language-text">LoadBalancer</code> 를 사용할 경우 <code class="language-text">kubectl get svc</code> 명령을 실행했을 때 <code class="language-text">EXTERNAL-IP</code> 항목에 로드밸런서 IP 확인 가능</li>
<li>해당 IP를 사용해 클러스터 외부에서 파드에 접근</li>
</ul>
</li>
<li>
<p>ExternalName</p>
<ul>
<li>서비스를 <code class="language-text">.spec.externalName</code> 필드에 설정한 값과 연결</li>
<li>클러스터 안에서 외부에 접근할 때 주로 사용</li>
<li>언제 클러스터 안에서 외부로 접근할까?</li>
<li><code class="language-text">ExternalName</code> 서비스로 클러스터 외부에 접근하면 설정해둔 <code class="language-text">CNAME</code> 값을 이용해 클러스터 외부에 접근 가능</li>
<li>클러스터 외부에 접근할 때 사용하는 값이므로 설정할 때 <code class="language-text">selector(.spec.selector)</code> 필드가 필요 없음</li>
<li><code class="language-text">selector</code> 필드는 서비스의 백엔드 파드를 지정할 때 사용</li>
</ul>
</li>
</ul>
<h2>서비스 사용</h2>
<h3>ClusterIP</h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> clusterip<span class="token punctuation">-</span>service <span class="token comment">#1</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP <span class="token comment">#2</span>
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> 10.10.10.10 <span class="token comment">#3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span> <span class="token comment"># 4</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment">#5</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span></code></pre></div>
<p><code class="language-text">#1</code></p>
<ul>
<li>서비스의 이름 지정</li>
</ul>
<p><code class="language-text">#2</code></p>
<ul>
<li>서비스 타입으로 ClusterIP 이용</li>
<li>타입 지정 안할 시 기본적으로 ClusterIP 이용</li>
</ul>
<p><code class="language-text">#3</code></p>
<ul>
<li>클러스터 IP 직접 설정할 때 사용</li>
</ul>
<p><code class="language-text">#4</code></p>
<ul>
<li>서비스에 연결할 백엔드 파드의 label 지정</li>
</ul>
<p><code class="language-text">#5</code></p>
<ul>
<li>서비스에서 사용할 포트 정보</li>
<li>현재는 TCP 프로토콜을 사용하며 서비스 포트 80번으로 요청을 받아 파드의 8080번 포트로 전달한다.</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ kubectl get <span class="token function">service</span>
NAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
clusterip-service   ClusterIP   <span class="token number">10.10</span>.10.10   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>/TCP    17s</code></pre></div>
<p>→ <code class="language-text">CLUSTER-IP</code> 생성되고 외부 IP는 존재하지 않으므로 <code class="language-text">EXTERNAL-IP</code>는 <code class="language-text">&lt;none></code></p>
<h3>NodePort</h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodeport<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort <span class="token comment">#1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app <span class="token comment">#2</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30001</span> <span class="token comment">#3</span></code></pre></div>
<p><code class="language-text">#1</code></p>
<ul>
<li>서비스 타입으로 NodePort 이용</li>
</ul>
<p><code class="language-text">#2</code></p>
<ul>
<li>서비스에 연결할 백엔드 파드의 label 지정</li>
</ul>
<p><code class="language-text">#3</code></p>
<ul>
<li>노드의 30001번 포트 사용</li>
<li>모든 노드의 30001번 포트를 이용하여 접근 가능</li>
<li>포트번호 지정 안할 시 <code class="language-text">30000 ~ 32768</code> 랜덤포트 사용</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ kubectl get <span class="token function">service</span>
NAME               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
nodeport-service   NodePort    <span class="token number">10.103</span>.127.52   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30001/TCP   19s</code></pre></div>
<p>→ NodePort 타입이지만 <code class="language-text">CLUSTER-IP</code>가 생성되고 노드의 30001번 포트가 <code class="language-text">CLUSTER-IP</code>타입 서비스의 80번 포트와 연결됨</p>
<h3>LoadBalancer</h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> lb<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer <span class="token comment">#1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span> <span class="token comment">#2</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p><code class="language-text">#1</code></p>
<ul>
<li>서비스 타입으로 LoadBalancer 이용</li>
</ul>
<p><code class="language-text">#2</code></p>
<ul>
<li>서비스에 연결할 백엔드 파드의 label 지정</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ kubectl get <span class="token function">service</span>
NAME         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
lb-service   LoadBalancer   <span class="token number">10.107</span>.254.85   <span class="token number">192.168</span>.0.181   <span class="token number">80</span>:31203/TCP   9s</code></pre></div>
<p>→ <code class="language-text">EXTERNAL-IP</code>가 생성되고 해당 IP를 통해 파드에 접근 가능</p>
<p>→ <code class="language-text">EXTERNAL-IP</code>로 요청을 보내면 트래픽은 노드의 31203번 포트로 들어온 뒤 파드의 targetPort로 들어감</p>
<h3>ExternalName</h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> externalname<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ExternalName <span class="token comment">#1</span>
  <span class="token key atrule">externalName</span><span class="token punctuation">:</span> google.com <span class="token comment">#2</span></code></pre></div>
<p><code class="language-text">#1</code></p>
<ul>
<li>서비스 타입으로 ExternalName 이용</li>
</ul>
<p><code class="language-text">#2</code></p>
<ul>
<li>연결하려는 외부 도메인 값 설정</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ kubectl get <span class="token function">service</span>
NAME                   TYPE           CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
externalname-service   ExternalName   <span class="token operator">&lt;</span>none<span class="token operator">></span>       google.com    <span class="token operator">&lt;</span>none<span class="token operator">></span>    1s

$ kubectl <span class="token builtin class-name">exec</span> -it netshoot -- <span class="token function">curl</span> externalname-service.default.svc.cluster.local
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span>en<span class="token operator">></span>
  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-<span class="token operator"><span class="token file-descriptor important">8</span>></span>
  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">name</span><span class="token operator">=</span>viewport <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">"initial-scale=1, minimum-scale=1, width=device-width"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>title<span class="token operator">></span>Error <span class="token number">404</span> <span class="token punctuation">(</span>Not Found<span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/title<span class="token operator">></span>
  <span class="token operator">&lt;</span>style<span class="token operator">></span>
    *<span class="token punctuation">{</span>margin:0<span class="token punctuation">;</span>padding:0<span class="token punctuation">}</span>html,code<span class="token punctuation">{</span>font:15px/22px arial,sans-serif<span class="token punctuation">}</span>html<span class="token punctuation">{</span>background:<span class="token comment">#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}</span>
  <span class="token operator">&lt;</span>/style<span class="token operator">></span>
  <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span>//www.google.com/<span class="token operator">></span><span class="token operator">&lt;</span>span <span class="token assign-left variable">id</span><span class="token operator">=</span>logo aria-label<span class="token operator">=</span>Google<span class="token operator">></span><span class="token operator">&lt;</span>/span<span class="token operator">></span><span class="token operator">&lt;</span>/a<span class="token operator">></span>
  <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token operator">&lt;</span>b<span class="token operator">></span><span class="token number">404</span>.<span class="token operator">&lt;</span>/b<span class="token operator">></span> <span class="token operator">&lt;</span>ins<span class="token operator">></span>That’s an error.<span class="token operator">&lt;</span>/ins<span class="token operator">></span>
  <span class="token operator">&lt;</span>p<span class="token operator">></span>The requested URL <span class="token operator">&lt;</span>code<span class="token operator">></span>/<span class="token operator">&lt;</span>/code<span class="token operator">></span> was not found on this server.  <span class="token operator">&lt;</span>ins<span class="token operator">></span>That’s all we know.<span class="token operator">&lt;</span>/ins<span class="token operator">></span>

$ kubectl <span class="token builtin class-name">exec</span> -it netshoot -- <span class="token function">dig</span> externalname-service.default.svc.cluster.local
<span class="token punctuation">..</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:
externalname-service.default.svc.cluster.local.	<span class="token number">30</span> IN CNAME google.com.
google.com.		<span class="token number">30</span>	IN	A	<span class="token number">172.217</span>.161.238</code></pre></div>
<p>→ <code class="language-text">ExternalName</code>을 이용하여 google.com에 접속</p>
<p>→ google.com에 대한 CNAME 레코드 생성</p>
<h2>헤드리스 서비스</h2>
<ul>
<li><code class="language-text">.spec.clusterIP</code> 필드 값을 <code class="language-text">None</code>으로 설정하면 클러스터 IP가 없는 <code class="language-text">헤드리스 서비스</code>를 만들 수 있음</li>
<li>로드밸런싱이 필요 없거나 단일 서비스 IP가 필요 없을 때 사용</li>
<li>
<p><code class="language-text">.spec.selector</code> 필드에 파드를 지정하면 쿠버네티스 API로 확인할 수 있는 엔드포인트가 생성됨</p>
<ul>
<li>서비스와 연결된 파드를 직접 가리키는 DNS A 레코드도 생성</li>
<li>selector가 없다면 엔드포인트는 만들어지지 않음</li>
</ul>
</li>
<li><code class="language-text">ExternalName</code> 서비스에서 사용할 CNAME 레코드 생성</li>
</ul>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> headless<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ kubectl get <span class="token function">service</span>
NAME               TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
headless-service   ClusterIP   None         <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>/TCP    2s</code></pre></div>
<p>→ CLUSTER-IP와 EXTERNAL-IP 모두 none</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ kubectl describe <span class="token function">service</span> headless-service
Name:              headless-service
Namespace:         default
Labels:            <span class="token operator">&lt;</span>none<span class="token operator">></span>
Annotations:       <span class="token operator">&lt;</span>none<span class="token operator">></span>
Selector:          <span class="token assign-left variable">app</span><span class="token operator">=</span>my-app
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                None
IPs:               None
Port:              <span class="token operator">&lt;</span>unset<span class="token operator">></span>  <span class="token number">80</span>/TCP
TargetPort:        <span class="token number">80</span>/TCP
Endpoints:         <span class="token number">10.244</span>.189.76:80,10.244.235.175:80
Session Affinity:  None
Events:            <span class="token operator">&lt;</span>none<span class="token operator">></span></code></pre></div>
<p>→ 파드에 대한 엔드포인트 생성</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ kubectl <span class="token builtin class-name">exec</span> -it netshoot -- <span class="token function">bash</span>
bash-5.2<span class="token comment"># dig headless-service.default.svc.cluster.local</span>
<span class="token punctuation">..</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:
headless-service.default.svc.cluster.local. <span class="token number">30</span> IN A <span class="token number">10.244</span>.189.76
headless-service.default.svc.cluster.local. <span class="token number">30</span> IN A <span class="token number">10.244</span>.235.175</code></pre></div>
<p>→ 파드에 대한 A 레코드 생성</p>
<br/>
<hr>
<p>참고</p>
<ul>
<li><a href="http://www.yes24.com/Product/Goods/85578606">쿠버네티스 입문</a></li>
</ul></div><ul class="post-styles__LinkList-sc-uvw59-3 gmHquH"><li><a rel="prev" class="styled-link__StyledLink-sc-1pzq7s8-0 iwJLgg" href="/multiple-az-k8s-cluster/">← <!-- -->다중 가용 영역 기반의 쿠버네티스 클러스터</a></li><li><a rel="next" class="styled-link__StyledLink-sc-1pzq7s8-0 iwJLgg" href="/k8s-calico-aws/">쿠버네티스에서 Calico 사용하기 in AWS<!-- --> →</a></li></ul><div class="comments-wrapper"><div>Loading script...</div><div></div></div><div class="share__Container-sc-1hk3kno-0 beCzyQ"><p class="share___StyledP-sc-1hk3kno-1 jiUAsV">Share if you liked it:</p></div></article></div><footer class="layout__Footer-sc-wzore3-0 doySxy"></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PB788GF0S1"></script><script>
        
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
        </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/k8s-service/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ed717a4fd71e6ab9d4db.js"],"app":["/app-2c7963cebb708efe718f.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-16703ee5599528db9f93.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9ead8f60164dc266ad59.js"],"component---src-pages-index-js":["/component---src-pages-index-js-911b6742c5b371483563.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-fe46313b564a949646ae.js"]};/*]]>*/</script><script src="/polyfill-ed717a4fd71e6ab9d4db.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-fe46313b564a949646ae.js" async=""></script><script src="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-257226443b7dcc72fbb2.js" async=""></script><script src="/app-2c7963cebb708efe718f.js" async=""></script><script src="/styles-bc72ca78f9bad9fb1f45.js" async=""></script><script src="/framework-45f0bfe9f06e0e8da7d0.js" async=""></script><script src="/webpack-runtime-302c830d723193e48eb2.js" async=""></script></body></html>